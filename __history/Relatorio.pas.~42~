unit Relatorio;

interface

uses
  Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants, System.Classes, Vcl.Graphics,
  Vcl.Controls, Vcl.Forms, Vcl.Dialogs, RLReport, Data.DB,
  FireDAC.Stan.Intf, FireDAC.Stan.Option, FireDAC.Stan.Param,
  FireDAC.Stan.Error, FireDAC.DatS, FireDAC.Phys.Intf, FireDAC.DApt.Intf,
  FireDAC.Stan.Async, FireDAC.DApt, FireDAC.Comp.DataSet,
  FireDAC.Comp.Client, FireDAC.UI.Intf, FireDAC.Stan.Def,
  FireDAC.Stan.Pool, FireDAC.Phys, FireDAC.Phys.FB, FireDAC.Phys.FBDef,
  FireDAC.VCLUI.Wait, Conexao;

type
  TFrmRelatorio = class(TForm)
    rlrRelatorio: TRLReport;
    rlbTitulo: TRLBand;
    rlbColunas: TRLBand;
    RLLabel1: TRLLabel;
    rlbDados: TRLBand;
    RLLabel2: TRLLabel;
    RLLabel3: TRLLabel;
    RLLabel4: TRLLabel;
    RLLabel5: TRLLabel;
    RLLabel6: TRLLabel;
    RLBand1: TRLBand;
    RLSystemInfo2: TRLSystemInfo;
    FDQuery: TFDQuery;
    FDQueryQUANTIDADE_LITROS: TFMTBCDField;
    FDQueryVALOR_ABASTECIDO: TFMTBCDField;
    FDQueryVALOR_TOTAL: TFMTBCDField;
    FDQueryIMPOSTO: TFMTBCDField;
    FDQueryNOME_BOMBA: TStringField;
    FDQueryTIPO_COMBUSTIVEL: TStringField;
    DataSource: TDataSource;
    RLDBText2: TRLDBText;
    RLDBText3: TRLDBText;
    RLDBText4: TRLDBText;
    RLDBText5: TRLDBText;
    FDQueryDATA: TSQLTimeStampField;
    RLLabel7: TRLLabel;
    RLLabel8: TRLLabel;
    RLDBText1: TRLDBText;
    FDMemTable1: TFDMemTable;
    procedure rlbDadosBeforePrint(Sender: TObject; var PrintIt: Boolean);
  private
    { Private declarations }
  public
    { Public declarations }
  constructor Create;//(const vpConexao: TFDConnection);
  end;

var
  FrmRelatorio: TFrmRelatorio;

implementation

{$R *.dfm}

constructor TFrmRelatorio.Create;//(const vpConexao: TFDConnection);
var
  viQuery: TFDQuery;
begin
  viQuery := nil;
  try
    viQuery := TFDQuery.Create(nil);
    viQuery.Connection := dmConexao.FDConnection;
    viQuery.SQL.Text := {$REGION 'MyRegion'}
      'SELECT '+
      '    P_A.QUANTIDADE_LITROS, '+
      '    P_A.VALOR_ABASTECIDO, '+
      '    P_A.IMPOSTO, '+
      '    P_A.DATA, '+
      '    P_B.NOME_BOMBA, '+
      '    P_T.TIPO_COMBUSTIVEL '+
      'FROM '+
      '    P_ABASTECIMENTO P_A '+
      'INNER JOIN '+
      '    P_BOMBA P_B ON P_B.BOMBA_ID = P_A.BOMBA_ID '+
      'INNER JOIN '+
      '    P_TANQUE P_T ON P_T.TANQUE_ID = P_B.TANQUE_ID ';
  {$ENDREGION}
    viQuery.Open;
    FDMemTable1.CopyFields(viQuery);
  finally
    FreeAndNil(viQuery);
  end;
end;

procedure TFrmRelatorio.rlbDadosBeforePrint(Sender: TObject;
  var PrintIt: Boolean);
begin
  RLLabel7.Caption := 'Gasolina';
  if FDQueryTIPO_COMBUSTIVEL.AsString = 'D' then
    RLLabel7.Caption := 'Diesel';
end;

end.
